フォルダ構成: 以下のような構造を想定しています。

Plaintext

親フォルダ(reports)/
├── フォルダA/
│   ├── index.htm
│   └── photo01.jpg
├── フォルダB/
│   ├── index.htm
│   └── photo02.jpg
└── cleaner.py (このスクリプト)
出力結果: converted_for_blogger というフォルダの中に、フォルダA_index.htm、フォルダB_index.htm という名前で保存されます。これにより、どのフォルダのファイルか一目で分かります。

Bloggerへの貼り付け:

変換されたHTML（1行になったもの）を全選択してコピー。

Bloggerの**「HTML表示」**モードに貼り付け。

**「作成」**モードに戻し、画像が割れている場所に実際の画像をペースト。

＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
pythonで下記仕様の処理を作って
「htmlキーワード追加」
    ルートにkeywords.xmlがある
    keywords.xmlにはMastkeywordsとHitkeywordsが複数ある
    複数のフォルダの中にhtml形式のファイルがあり、すべて処理する
    htmlを読み以下の処理を行う
        <meta name="keywords" content="">がなければ、追加する
        <meta name="keywords" content="">にMastkeywords追加する
        html内を検索しHitkeywordsと同じ文字があれば、
            <meta name="keywords" content="">にMastkeywords追加する
また、keywords.xmlのサンプルも作成して
＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝

事前準備：Google Cloudでの設定
Blogger APIを使うには、Google Cloud ConsoleでAPIを有効にし、**認証情報（credentials.json）**を取得する必要があります。

Google Cloud Console にアクセスし、新しいプロジェクトを作成します。
https://console.cloud.google.com/

[APIとサービス] > [ライブラリ] > [ブログ,CMS] で「Blogger API v3」を検索し、有効化します。

[APIとサービス] > [OAuth同意画面] で開始。


「OAuth同意画面」の設定の第1段階（ブランディング）ですね。以下の3箇所だけ入力すれば、次に進めます。

「アプリ情報」画面の入力内容
この画面では、**「誰がこのプログラム（API）を使うのか」**を登録します。自分専用なので、内容は簡単で大丈夫です。

アプリ名 (App Name):

適当な名前（例: My Blogger Uploader）を入力してください。

ユーザー サポートメール:

ご自身のGmailアドレスをプルダウンから選択してください。

デベロッパーの連絡先情報 (画面の一番下):

「メールアドレス」という入力欄がありますので、そこにもう一度ご自身のGmailアドレスを入力してください。

「外部」を選択し、メールアドレスなどを入力）。

デベロッパーの連絡先情報 (画面の一番下):

「メールアドレス」という入力欄がありますので、そこにもう一度ご自身のGmailアドレスを入力してください。

それ以外の「アプリのロゴ」や「アプリのドメイン」などは、すべて空欄のままでOKです。

一番下の [保存して次へ]（または [作成]） ボタンを押してください。

その後の流れ（重要）
「保存して次へ」を何度か押していくと、設定が完了します。その後、本来の目的である credentials.json を取得するために、以下の手順を行ってください。

左メニューの [認証情報] (Credentials) をクリックします。

上部の [+ 認証情報を作成] をクリックし、[OAuth クライアント ID] を選択します。

「アプリケーションの種類」で [デスクトップ アプリ] を選択します。

名前は適当なままで [作成] を押します。

現れた画面の [JSON をダウンロード] をクリックして、保存したファイルの名称を credentials.json に変更してください。

次に確認すること
スクリーショットを見ると、プロジェクト名が pro-blogger となっていますね。そのプロジェクト内で作業を続ければ大丈夫です。

「認証情報」の作成画面までたどり着けそうでしょうか？ もし「スコープ」や「対象」という画面で迷うことがあれば、またスクリーンショットを撮って教えてください。



[APIとサービス] > [認証情報] で、[認証情報を作成] > [OAuth クライアント ID] を選択します。

種類は「デスクトップ アプリ」を選択。

作成後、JSONファイルをダウンロードし、名前を credentials.json に変更してスクリプトと同じフォルダに置きます。
------------------------------------------------------------------------------
Pythonスクリプト：一括アップロード（下書き保存）
このスクリプトは、指定したフォルダ内のHTMLファイルを読み込み、**「下書き（DRAFT）」**状態でBloggerに投稿します。

必要なライブラリのインストール:

Bash

pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib
アップロード用スクリプト (uploader.py):
------
kusa@kusa-PC:~$ pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib
error: externally-managed-environment

× This environment is externally managed
╰─> To install Python packages system-wide, try apt install
    python3-xyz, where xyz is the package you are trying to
    install.
------

Linuxの最近のバージョン（Ubuntu 23.04以降など）では、システム全体のPython環境を保護するために、pipで直接パッケージをインストールしようとするとそのエラーが出るようになっています。

これを解決するには、**「仮想環境（venv）」**を作成するのが最も安全で標準的な方法です。以下の手順をターミナルで実行してください。

1. 仮想環境の作成と有効化
まず、プロジェクト用のフォルダに移動してから、仮想環境を作成して起動します。

Bash

# 1. 仮想環境を作成（名前を 'venv' にする場合）
python3 -m venv venv

# ※ もしここでエラーが出る場合は、先に以下のコマンドを実行してください
# sudo apt update && sudo apt install python3-venv

# 2. 仮想環境を有効化（起動）
source venv/bin/activate
有効化されると、ターミナルの左端に (venv) と表示されるはずです。

2. パッケージのインストール
有効化した状態（(venv) が出ている状態）で、もう一度インストールを試してください。今度はエラーなく通るはずです。

Bash

pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib
3. スクリプトの実行方法
今後、このスクリプト（uploader.py）を実行するときは、必ずこの仮想環境を「有効化」してから実行します。

ターミナルを開く

source venv/bin/activate を実行

python uploader.py を実行

「どうしても面倒な場合」の回避策（非推奨）
仮想環境を使わずに、強制的にインストールするフラグもありますが、システムのPythonを壊すリスクがあるため、基本的には上記の方法をおすすめします。 ※実行する場合は自己責任でお願いします： pip install --upgrade ... --break-system-packages

まずは 仮想環境（venv） を作ってみてください。もし python3-venv が入っていないというエラーが出たら、メッセージに従って sudo apt install してください。

--------------------------------------------------------------
手順：テストユーザーの登録
Google Cloud Console にアクセスします。

左メニューの [API とサービス] > [OAuth 同意画面] をクリックします。

画面を下にスクロールすると [テストユーザー] という項目があります。

[+ ADD USERS] ボタンをクリックします。

ご自身のメールアドレス（guizhigaomu823@gmail.com）を入力して [保存] を押します。

その後、もう一度実行してください
ターミナルに戻り、再度 python3 uploader.py を実行します。

ブラウザが開いたら、先ほどと同じアカウントを選択します。

今度は「アクセスをブロック」ではなく、「このアプリは Google で確認されていません」 という警告画面が出るはずです。

その画面にある [詳細] をクリックします。

一番下に出現する [My Blogger Uploader（安全ではない）に移動] をクリックして進めてください。

これで API の認証が完了し、記事のアップロードが始まります。

万が一、まだエラーが出る場合
「OAuth 同意画面」の [公開ステータス] が「テスト中」になっていることを確認してください。もし「本番環境」に移行しようとしていると、より厳しい審査が必要になってしまいます。個人利用であれば「テスト中」のままで問題ありません。

スクリーンショットをありがとうございます！今開いている「対象（オーディエンス）」画面の中に、テストユーザーを登録する場所が映っています。

以下の手順で進めてください。

1. テストユーザーを追加する
画面中央にある 「＋ Add users」 ボタンをクリックしてください。

2. メールアドレスを入力する
ボタンを押すと入力欄が表示されますので、ログインしようとしているご自身のメールアドレス guizhigaomu823@gmail.com を入力し、「追加」または「保存」を押します。

これで、Googleの審査を通っていなくても、あなた自身だけはこのアプリを使えるようになります。

その後のステップ：認証情報のダウンロード
テストユーザーの登録が終わったら、次はプログラムを動かすための「鍵（JSONファイル）」を取得する必要があります。

左側のメニューにある 「クライアント」（または Credentials / 認証情報）をクリックします。

以前「OAuth クライアント ID」を作成済みであれば、そこにリストが表示されます。右側にある 「ダウンロード」アイコン（↓） を押して JSON ファイルを保存してください。

まだ作成していない場合は、上部の 「＋ 認証情報を作成」 から 「OAuth クライアント ID」 を選び、「デスクトップ アプリ」として作成してください。

ダウンロードしたファイルの名前を credentials.json に変更して、uploader.py と同じフォルダに置きます。

仕様１
>htmlに設定されている画像サイズの縦長、横長を判定する
>判定した結果の横幅と設定するサイズの横幅を比べ、
>小さい方に合わせる
>例外として小より小さいものは小とする
設定する画像サイズ　
横長小height="150" width="200"
横長中height="240" width="320"
横長大height="300" width="400"
横長特大height="480" width="640"
縦長小eight="200" width="150"
縦長中height="320" width="240"
縦長大height="400" width="300"
縦長特大height="640" width="480"
>例
1.html height="302" width="420" -> 横長 -> eight="300" width="400"
2.html height="162" width="222" -> 横長 -> eight="150" width="400"
3.html height="223" width="165" -> 縦長 -> eight="400" width="150"

仕様２
>写真をリンクさせる

>(スクリプトの処理)
>フォルダー内にある画像ファイルを
>フォルダー名とファイル名をつなげ、新たなファイル名とする
>例 AAA/111.jpg -> AAA111.jpg
>新たなファイル名でアップロード用フォルダにコピーする
>フォルダー内にあるブログhmlファイル内に記述されたファイル名も新ファイル名に変える
>（人の作業）
>ユーザーがアップロード用フォルダの画像をブロガーにアップロードする
>２．”ブロガーメディアマネージャー_xxxx.html”を取得し、実行するフォルダに置く
>(スクリプトの処理)
>ブログhmlファイル内の画像ファイル名から ”ブロガーメディアマネージャー_xxxx.html”のファイル名だけで一致するものを探す
>一致した場合、ブログhmlファイル内の画像ファイル名に”ブロガーメディアマネージャー_xxxx.html”のフォルダ名を追加する
>例
”ブロガーメディアマネージャー_xxxx.html”内の定義
"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEifW5BCy8NPOQrQV9wy855UcdV1a4gXqpP-8Rw8GPSAGDyrQoyc4ouUZ7R-bcWuZw20MuVikPThv5YvHRRNe-6anChzV5Etsyiv7rxk1NWRuMxIAW_mCGMoLBswHeQAE2c-qTkWu1kiLkqPA8bPY8ijWwNnBYRFY7b9sZsZyQka04PEyxg/s1600/taki.jpg"

処理前のブログhmlファイル内の画像ファイル名
"https://tai01.jpg" 
処理後のブログhmlファイル内の画像ファイル名


事前準備（人の作業）:

古いフォルダ内の画像を「フォルダ名＋ファイル名」にリネームして1つのフォルダにまとめ、Bloggerにアップロードします。

Bloggerのメディアマネージャー画面を「名前を付けて保存」し、Blogger メディア マネージャー_ddd.html という名前でスクリプトと同じ場所に置きます 。

仕様1（画像リサイズ）の実装:

resize_logic 関数で、縦長・横長を判定し、規定のサイズ（特大・大・中・小）の中で「現在のサイズを超えない最大のサイズ」を選択します。

幅が200px（横長の場合）未満の小さな画像でも、仕様通り「小」サイズに引き上げます。

仕様2（URL置換）の実装:

load_media_mapping 関数がメディアマネージャーのHTMLを解析し、taki.jpg などのファイル名と、Googleサーバー上の長いURL（https://blogger.googleusercontent.com/...）の対応表を作ります。

記事本文を投稿する直前に、本文内の古い画像パスをこの正規URLに自動で書き換えます。



使い方のコツ
ブログIDの確認: Bloggerにログインし、管理画面（記事一覧など）を表示した時のブラウザのアドレスバーを確認してください。blogID=123456789... という数字の部分があなたの BLOG_ID です。

最初は「下書き」保存: スクリプト内の isDraft=True により、勝手に公開されることはありません。226本すべてが一度「下書き」に入るので、Bloggerの管理画面で一つずつ開き、画像をペーストして公開ボタンを押していく流れになります。

タイトルについて: 以前のステップでHTML内の <title> タグを削除してしまったため、このスクリプトでは暫定的に「フォルダ名_ファイル名」を記事タイトルにしています。これも管理画面で簡単に修正可能です。

注意点：APIの制限
Google APIには1日のリクエスト制限がありますが、226件程度であれば一度に実行しても全く問題ありません。

このAPI連携で、226本の下書き作成は数分で終わるはずです！準備で不明な点があれば、いつでも聞いてくださいね。

次に必要なステップ：

Google Cloud Consoleでの認証情報取得で詰まったところはありませんか？

記事のタイトルを特定のルール（例えば1行目を使うなど）で自動設定したい場合は教えてください。
