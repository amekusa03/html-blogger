# Google Cloud & Blogger API セットアップガイド

⚠️ **このセットアップはオプションです** - まず [QUICKSTART.md](QUICKSTART.md) で動作確認を完了してから、Google Cloud設定に進むことをお勧めします。

## 概要

このドキュメントは、HTMLtoBloggerを使用するために必要なGoogle CloudプロジェクトとBlogger API v3の設定手順を説明します。

## 前提条件

- Googleアカウント（@gmail.comまたはGoogle Workspace）
- Google CloudConsoleへのアクセス権限
- 投稿対象のBloggerブログ（すでに所有）
- インターネット接続

## ステップ1: Google Cloudプロジェクトの作成

### 1.1 Google Cloud Consoleにアクセス

```
https://console.cloud.google.com
```

ブラウザで上記URLにアクセスし、Googleアカウントでログインします。

### 1.2 新しいプロジェクトを作成

1. ページ上部の「プロジェクト選択」をクリック
2. 「新しいプロジェクト」ボタンをクリック
3. 以下を入力：
   - **プロジェクト名**: `HTMLtoBlogger` （任意の名前）
   - **組織**: デフォルトのまま
4. 「作成」をクリック

### 1.3 プロジェクトを選択

作成が完了すると、自動的に新しいプロジェクトに切り替わります。

## ステップ2: Blogger API v3を有効化

### 2.1 APIライブラリを開く

左側のナビゲーションメニューから：
```
APIとサービス → ライブラリ
```

### 2.2 Blogger APIを検索・有効化

1. 検索ボックスに「Blogger API」と入力
2. 検索結果から「Blogger API v3」を選択
3. 「有効にする」ボタンをクリック
4. 有効化が完了するまで待機（数秒）

## ステップ3: OAuth 2.0認証情報を設定

### 3.1 OAuth同意画面を設定

1. 左側メニューから：
   ```
   APIとサービス → OAuth同意画面
   ```

2. **User Type**として「外部」を選択
3. 「作成」をクリック

### 3.2 OAuth同意画面の詳細を入力

**必須フィールド:**

| フィールド | 入力内容 | 例 |
|-----------|--------|-----|
| **アプリ名** | アプリケーションの名前 | `HTMLtoBlogger` |
| **ユーザーサポートメール** | サポート用メールアドレス | `your-email@gmail.com` |
| **デベロッパー連絡先情報** | あなたのメールアドレス | `your-email@gmail.com` |

4. 「保存して続行」をクリック

### 3.3 スコープを設定（オプション）

- デフォルトのまま「保存して続行」をクリック
- 次のページでも「保存して続行」をクリック

### 3.4 テストユーザーを追加

1. 「テストユーザー」セクションで「+ ユーザーを追加」をクリック
2. 自分のGoogleメールアドレスを入力
3. 「追加」をクリック
4. 「保存して続行」をクリック

## ステップ4: デスクトップアプリの認証情報を作成

### 4.1 認証情報ページへ移動

```
APIとサービス → 認証情報
```

### 4.2 OAuth クライアントIDを作成

1. 「+ 認証情報を作成」をクリック
2. ドロップダウンから「OAuth クライアント ID」を選択
3. 以下を設定：
   - **アプリケーションの種類**: 「デスクトップアプリ」を選択
   - **名前**: `HTMLtoBlogger Desktop` （任意）
4. 「作成」をクリック

### 4.3 認証情報をダウンロード

1. 作成完了後、ダウンロードボタン（↓アイコン）をクリック
2. JSONファイルが自動ダウンロードされます
3. ファイル名を `credentials.json` に変更
4. プロジェクトルート（`html_tobrogger.py`と同じフォルダ）に配置

```
htmltobrogger/
├── html_tobrogger.py
├── credentials.json  ← ここに配置
├── add_keywords.py
├── ...
```

## ステップ5: Bloggerブログの情報を取得

### 5.1 ブログIDの確認

1. [Bloggerダッシュボード](https://www.blogger.com) にアクセス
2. 対象のブログを選択
3. ブラウザのURL欄を確認：
   ```
   https://www.blogger.com/blog/posts/{BLOG_ID}
   ```
   `{BLOG_ID}` の数字をメモしておきます

### 5.2 ブログIDを設定

`config.ini`の`[OPEN_BLOGGER]`セクションを編集：

```ini
[OPEN_BLOGGER]
ENABLED = true
BLOG_ID = 1234567890123456789
```

## ステップ6: 初回認証フロー

### 6.1 アプリケーションを起動

```bash
python html_tobrogger.py
```

### 6.2 初回認証

1. アップロード処理を試行すると、ブラウザが自動で開きます
2. Googleアカウントの選択画面が表示されます
3. 「HTMLtoBlogger」アプリへのアクセスを許可するよう求められます
4. 「許可」をクリック

### 6.3 トークンの自動保存

1. 初回認証が完了すると、`token.pickle`が自動生成されます
2. このファイルには認証トークンが保存されます
3. 次回以降は自動的に認証情報が使用されます

⚠️ **注意**: `token.pickle`は秘密ファイルです。GitHubなどに公開しないでください。`.gitignore`で除外されています。

## ステップ7: トークンのリフレッシュ

認証トークンは一定期間後に期限切れになります。その場合：

1. 次のアップロード時に自動的にリフレッシュされます
2. 再度ブラウザで認証するよう求められる場合があります
3. 上記ステップ6.2-6.3を繰り返してください

## トラブルシューティング

### Q: 「No module named google」エラーが出る

A: 依存パッケージをインストールしてください：
```bash
pip install -r requirements.txt
```

### Q: 「403 Permission Denied」エラー

A: 以下を確認：
1. `credentials.json`がプロジェクトルートに配置されているか
2. Google CloudでBlogger API v3が有効化されているか
3. テストユーザーに自分のメールアドレスが追加されているか

### Q: token.pickle が生成されない

A: 以下を確認：
1. `credentials.json`の形式が正しいか
2. インターネット接続が確立されているか
3. Google Cloudのクォータ制限に達していないか

### Q: ブラウザが自動で開かない

A: 以下を試してください：
1. ターミナル出力のURLをコピーして手動で開く
2. システムのブラウザ設定を確認
3. Windows Subsystem for Linux (WSL)の場合は、`xdg-open`の設定を確認

## セキュリティに関する注意

⚠️ **絶対にしてはいけないこと:**
- ❌ GitHubなどのパブリックリポジトリに`credentials.json`をコミット
- ❌ 他人に`credentials.json`や`token.pickle`を共有
- ❌ これらのファイルをメールで送信

✅ **推奨事項:**
- `.gitignore`にこれらのファイルが含まれていることを確認
- 定期的に不要な認証情報を削除（Google Cloud Consoleから）
- 複数のGoogle Cloudプロジェクトを使用する場合は、それぞれ分離してください

## API割り当て（クォータ）

Google Blogger APIには以下の制限があります：

- **ユーザー単位**: 1日あたり1,000,000ユーザー呼び出し
- **プロジェクト単位**: 1日あたり2,000,000ユーザー呼び出し
- **ユーザー単位**: 100秒あたり1,000リクエスト

**注意**: 大量のブログを一度にアップロードすると、割り当てに達する可能性があります。その場合は翌日まで待つ必要があります。

## リセット方法

何か問題が発生した場合、以下の手順でリセットできます：

### 認証情報をリセット

1. 以下のファイルを削除：
   ```bash
   rm token.pickle
   ```

2. Google Cloud Consoleで古いOAuth認証情報を削除（オプション）

3. アプリケーションを再起動すると、初回認証フローが再実行されます

### プロジェクト全体をリセット

1. Google Cloud Consoleでプロジェクトを削除
2. ステップ1から再度実行

## サポート

問題が発生した場合：

1. [トラブルシューティング](TROUBLESHOOTING.md)を確認
2. Google Cloud [ドキュメント](https://cloud.google.com/docs) を参照
3. [Blogger API リファレンス](https://developers.google.com/blogger)を確認

---

**最終更新**: 2026年1月25日
