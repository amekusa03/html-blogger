# HTML to Blogger Ver0.85(次期Version検討中)

ローカルにあるHTMLファイルと画像を、自動的に処理してBloggerに投稿するためのデスクトップアプリケーションです。
HTMLのクリーニング、画像への透かし追加、キーワードや位置情報の付与、そしてBloggerへのアップロードを一貫したパイプラインとして実行します。

## 主な機能

*   **HTMLクリーニング**: 不要なタグの削除、フォーマットの正規化。
*   **画像処理**: 画像のリサイズ、EXIF削除、透かし（ウォーターマーク）の追加。
*   **メタデータ付与**: 本文解析によるキーワード(`search`タグ)や位置情報(`georss`タグ)の自動追加。
*   **Bloggerアップロード**: 画像と記事をBlogger APIを使用して下書きとして投稿。
*   **GUI操作**: 進行状況の可視化、エラー時のリカバリー機能などを備えた使いやすいGUI。

## 動作環境

*   Python 3.8 以上
*   Google Cloud Platform (GCP) プロジェクトとBlogger APIの有効化

## インストール方法

### 1. ソースコードの配置
このツール一式を任意のフォルダに配置してください。

### 2. 依存ライブラリのインストール
以下のコマンドを実行して、必要なPythonライブラリをインストールします。

```bash
pip install beautifulsoup4 google-api-python-client google-auth-oauthlib google-auth-httplib2 Pillow piexif geopy janome pykakasi
```

※ Linux (Ubuntu等) をご使用の場合、Tkinterのインストールが必要な場合があります。
```bash
sudo apt-get install python3-tk
```

## 初期設定

### 1. Google API 認証情報の準備
1.  Google Cloud Console にアクセスし、プロジェクトを作成します。
2.  「APIとサービス」>「ライブラリ」から **Blogger API v3** を検索し、有効にします。
3.  「APIとサービス」>「認証情報」から **OAuth 2.0 クライアントID** を作成します（アプリケーションの種類は「デスクトップアプリ」）。
4.  作成した認証情報のJSONファイルをダウンロードし、**`credentials.json`** という名前でこのツールのフォルダ（`html_tobrogger.py` と同じ場所）に保存します。

### 2. アプリケーションの起動
以下のコマンドでGUIアプリを起動します。

```bash
python3 html_tobrogger.py
```

### 3. ブログIDの設定
初回起動時、または設定ファイルにブログIDがない場合、設定ウィザードが始まります。
1.  ダイアログの案内に従い、投稿先のBloggerブログの管理画面（投稿一覧ページ）を開きます。
2.  ブラウザのURLバーからURLをコピーし、ツールの入力欄に貼り付けます。
    *   例: `https://www.blogger.com/blog/posts/1234567890123456789`
3.  ツールが自動的にブログID（上記の例なら `1234567890123456789`）を抽出して保存します。

※ 初回実行時のみ、ブラウザが開きGoogleアカウントへのログインと権限の許可（OAuth認証）が求められます。

## 使い方

### 基本的な流れ

1.  **原稿の準備**:
    *   `reports` フォルダに、投稿したいHTMLファイルと画像ファイルを配置します。
    *   GUIの「フォルダ」エリアにある「📄 原稿 (Reports)」ボタンでフォルダを開けます。

2.  **処理の実行**:
    *   GUI右下の **「次へ」** ボタンをクリックします。
    *   パイプライン処理（クリーニング → 画像処理 → キーワード追加 → アップロードなど）が順次実行されます。

3.  **完了**:
    *   すべての処理が正常に終わると「完了」メッセージが表示されます。
    *   Bloggerの下書き一覧に記事が投稿されていることを確認してください。

### 手動アップロードが必要な場合
Blogger APIの制限などにより、画像の自動アップロードができない場合は、手動アップロードモードに切り替わります。

1.  **画像アップロード**:
    *   案内ダイアログが表示され、加工済み画像フォルダが開きます。
    *   Bloggerの投稿画面を開き、フォルダ内の画像をドラッグ＆ドロップでアップロードしてください。
    *   完了したらツールの「次へ」を押します。

2.  **HTMLの保存**:
    *   案内ダイアログが表示され、HTML保存用フォルダが開きます。
    *   Bloggerの投稿画面を「HTMLビュー」に切り替え、全コードをコピーします。
    *   コピーしたコードをテキストファイル（例: `blogger.html`）として保存用フォルダに保存します。
    *   完了したらツールの「次へ」を押します。

3.  ツールがHTML内の画像URLを解析し、ローカルのリンクをBloggerのURLに置換して処理を続行します。

## トラブルシューティング

*   **エラーが発生した場合**:
    *   ログウィンドウに赤字でエラー内容が表示されます。
    *   一時的な通信エラーなどの場合は、**「強制的に次へ」** ボタンが表示されます。これを押すと、エラーステータスをリセットして再試行できます。
    *   ファイル自体の問題（文字コード不明など）の場合は、ファイルを修正してから再実行してください。

*   **設定を変更したい**:
    *   メニューバーの「設定編集」から `config.ini` や `keywords.xml` を直接編集できます。

## ライセンス / クレジット

*   © OpenStreetMap contributors
*   その他、使用しているライブラリのライセンスに従います。
