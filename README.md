# HTML to Blogger Ver0.98

ローカルにあるHTMLファイルと画像を、自動的に処理してBloggerに投稿するためのデスクトップアプリケーションです。
HTMLのクリーニング、画像への透かし追加、キーワードや位置情報の付与、そしてBloggerへのアップロードを実行します。

## 主な機能

*   **HTMLクリーニング**: 投稿に不要なタグの削除、フォーマットの正規化。
*   **画像処理**: 画像のEXIF削除、透かし（ウォーターマーク）の追加。
*   **メタデータ付与**: 本文解析によるキーワード(`search`タグ)や位置情報(`georss`タグ)の自動追加。
*   **Bloggerアップロード**: 画像リンクと記事をBlogger APIを使用して下書きとして投稿。
*   **GUI操作**: 進行状況の可視化、エラー時のリカバリー機能などを備えた使いやすいGUI。

## ファイル構成と役割

本プロジェクトは、機能ごとにモジュール化されたPythonスクリプトで構成されています。

### メイン・GUI
*   **`html_tobrogger.py`**: アプリケーションのエントリーポイント。Tkinterを使用したGUIを提供し、ユーザー操作を受け付けます。
*   **`main_process.py`**: バックグラウンドで動作するメイン処理コントローラー。各処理モジュールを順次呼び出し、処理を順次制御を行います。

### 処理モジュール (実行順)
1.  **`import_file.py`**: 原稿フォルダから作業フォルダへファイルを取り込みます。画像・HTMLの形式チェックとバックアップを行います。
2.  **`serial_file.py`**: ファイル名を連番形式（シリアル番号）に変換し、フォルダ構造をフラット化します。
3.  **`clean_html.py`**: HTMLのタグ除去、スタイル削除、フォーマット正規化を行い、Bloggerに適した形式にします。
4.  **`find_keyword.py`**: 記事本文からキーワードを抽出し、`<search>`タグとして埋め込みます。
5.  **`find_location.py`**: 記事内の地名を抽出し、ジオコーディングを行って位置情報タグを追加します。
6.  **`find_date.py`**: 記事内の日付表現を解析し、`<time>`タグを追加します。
7.  **`mod_image.py`**: 画像のリサイズ、透かし（ウォーターマーク）の追加、EXIF情報の削除を行います。
8.  **`upload_image.py`**: 画像ファイルをアップロード用フォルダに準備します。
9.  **`link_html.py`**: Bloggerのメディアマネージャーから取得した画像URLリストを元に、HTML内のローカル画像リンクをWeb上のURLに置換します。
10. **`upload_art.py`**: 完成したHTML記事をBlogger APIを使用して下書きとしてアップロードします。

### ユーティリティ・設定
*   **`file_class.py`**: ファイル操作を補助する `SmartFile` クラス定義。
*   **`parameter.py`**: 設定ファイル (`config.json5`) の読み込みとパラメータ管理。
*   **`auth_google.py`**: Google APIのOAuth認証処理を担当。

## 動作環境

*   Python 3.8 以上
*   Google Cloud Platform (GCP) プロジェクトとBlogger APIの有効化

## インストール方法

### 1. ソースコードの配置
このツール一式を任意のフォルダに配置してください。

### 2. 依存ライブラリのインストール
以下のコマンドを実行して、必要なPythonライブラリをインストールします。
`requirements.txt` が含まれているため、一括インストールが可能です。

```bash
pip install -r requirements.txt
# または pip install beautifulsoup4 google-api-python-client google-auth-oauthlib google-auth-httplib2 Pillow geopy janome
```

※ Linux (Ubuntu等) をご使用の場合、Tkinterのインストールが必要な場合があります。
```bash
sudo apt-get install python3-tk
```

## 初期設定

### 1. Google API 認証情報の準備
1.  Google Cloud Console にアクセスし、プロジェクトを作成します。
2.  「APIとサービス」>「ライブラリ」から **Blogger API v3** を検索し、有効にします。
3.  「APIとサービス」>「認証情報」から **OAuth 2.0 クライアントID** を作成します（アプリケーションの種類は「デスクトップアプリ」）。
4.  作成した認証情報のJSONファイルをダウンロードし、**`credentials.json`** という名前でこのツールのdataフォルダに保存します。

### 2. アプリケーションの起動
以下のコマンドでGUIアプリを起動します。

```bash
python3 html_tobrogger.py
```

### 3. ブログIDの設定
ブログIDをconfig.json5設定保存して下さい。
※ 初回実行時のみ、ブラウザが開きGoogleアカウントへのログインと権限の許可（OAuth認証）が求められます。

## 使い方

### 基本的な流れ

1.  **原稿の準備**:
    *   `reports` フォルダに、投稿したいHTMLファイルと画像ファイルを配置します。
    *   GUIの「フォルダ」エリアにある「📄 原稿 (Reports)」ボタンでフォルダを開けます。

2.  **処理の実行**:
    *   GUI右下の **実行** ボタンをクリックします。
    *   クリーニング → 画像処理 → キーワード追加 → アップロードが順次実行されます。

3.  **画像アップロード**:
    *   案内ダイアログが表示され、加工済み画像フォルダが開きます。
    *   Bloggerdeで新しい記事を選び、フォルダ内の画像を貼り付けてください。
    *   新しい記事は**下書き**として保存して下さい。
    *   完了したらツールの「 実行」を押します。

3.  **メディアマネージャーの解析**:
    *   案内ダイアログが表示され、HTML保存用フォルダが開きます。
    *   Bloggerの投稿画面を「メディアマネージャー」に切り替え、HTML形式でmedia_manフォルダに置きます。
    *   コピーしたコードをテキストファイル（例: `blogger.html`）として保存用フォルダに保存します。
    *   完了したらツールの「 実行」を押します。
    *   ツールが画像URLを解析し、記事のリンクをBloggerのURLに置換して処理を続行します。

4.    **記事アップロード**
    *   記事が自動投稿をします。
    *   自動投稿がu完了するとBloggerの下書きになっていますので、確認し**公開**して下さい

## トラブルシューティング

*   **エラーが発生した場合**:
    *   ログウィンドウに赤字でエラー内容が表示されます。
    *   ファイル自体の問題（文字コード不明など）の場合は、ファイルを修正してから再実行してください。

*   **設定を変更したい**:
    *   メニューバーの「設定編集」から `config.json5` や `keywords.xml` を直接編集できます。

## ライセンス / クレジット

*   © OpenStreetMap contributors
*   その他、使用しているライブラリのライセンスに従います。
